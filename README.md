# M3U播放列表管理器

一个用Python编写的高效、交互式M3U播放列表管理工具，专为macOS系统设计，支持大量音乐文件的管理和播放列表创建。

## 🎵 项目简介

M3U播放列表管理器是一个功能强大的命令行工具，能够扫描音乐目录、提供交互式界面来选择歌曲，并生成标准的M3U播放列表文件。无论你有几百首还是几千首歌曲，都能轻松管理。

## ✨ 功能特点

### 核心功能
- 🎯 **智能音乐扫描**：自动递归扫描音乐目录，支持嵌套文件夹
- 📱 **交互式界面**：流畅的键盘操作，无需鼠标
- 📄 **分页显示**：每页20首歌曲，避免屏幕溢出
- 🔍 **快速搜索**：支持歌曲名称关键词搜索
- ➕ **智能追加**：向现有播放列表添加歌曲，自动去重
- 💾 **标准格式**：生成标准M3U格式播放列表
- 🚀 **性能优化**：无闪烁界面，响应迅速

### 支持的音乐格式
- MP3 (.mp3)
- FLAC (.flac) - 无损音质
- WAV (.wav) - 无损音质
- AAC (.aac)
- M4A (.m4a)
- OGG (.ogg)
- WMA (.wma)

## 🛠️ 系统要求

- **操作系统**：macOS (已针对macOS优化)
- **Python版本**：Python 3.6+
- **依赖**：仅使用Python标准库，无需额外安装

## 📦 安装使用

### 快速开始

1. **下载项目文件**
   ```bash
   # 确保m3u_weaver.py文件在当前目录
   ls m3u_weaver.py
   ```

2. **运行程序（多种方式）**
   ```bash
   # 使用默认配置
   python3 m3u_weaver.py
   
   # 指定音乐目录
   python3 m3u_weaver.py -d /Users/song/Music
   
   # 交互式配置音乐目录
   python3 m3u_weaver.py --config
   
   # 自定义页面大小
   python3 m3u_weaver.py --page-size 30
   
   # 查看帮助
   python3 m3u_weaver.py --help
   ```

### 🔧 配置管理

程序支持多种配置方式，按优先级排序：

1. **命令行参数**（最高优先级）
2. **配置文件**（`music_config.json`）
3. **交互式配置**
4. **默认值**（最低优先级）

#### 命令行配置
```bash
# 基本用法
python3 m3u_weaver.py -d /path/to/music

# 完整配置
python3 m3u_weaver.py -d ~/Music --page-size 25
```

#### 交互式配置
```bash
python3 m3u_weaver.py --config
```
程序会引导你：
- 输入自定义路径
- 选择常见音乐目录位置
- 使用默认路径

#### 配置文件
程序会自动生成 `music_config.json` 配置文件：
```json
{
  "music_dir": "/Users/song/Music",
  "page_size": 20
}
```

#### 重置配置
```bash
python3 m3u_weaver.py --reset-config
```

## 🎮 操作指南

### 基本操作
| 按键 | 功能 |
|------|------|
| ↑↓ | 移动选择光标 |
| 空格 | 选中/取消当前歌曲 |
| ←→ | 左右翻页 |
| Enter | 循环翻页 |
| PgUp/PgDn | 上一页/下一页 |

### 高级功能
| 按键 | 功能 |
|------|------|
| `/` | 开始搜索 |
| Esc | 清除搜索（搜索模式下） |
| A | 追加到现有播放列表 |
| S | 保存播放列表 |
| Q | 退出程序 |

### 界面符号说明
| 符号 | 含义 |
|------|------|
| ▶ | 当前选中行 |
| ✓ | 已选择的歌曲 |
| ● | 已在播放列表中的歌曲（追加模式） |
| ○ | 已在播放列表中且新选择的歌曲 |

## 📋 使用场景

### 1. 创建新播放列表
1. 启动程序
2. 使用方向键浏览歌曲
3. 空格键选择喜欢的歌曲
4. 按S键保存，输入播放列表名称

### 2. 搜索特定歌曲
1. 按`/`键进入搜索模式
2. 输入艺术家名或歌曲关键词
3. 在搜索结果中选择歌曲
4. 按Esc键清除搜索

### 3. 向现有播放列表添加歌曲
1. 按A键选择现有播放列表
2. 程序会显示已存在的歌曲（●符号）
3. 选择新歌曲添加
4. 按S键确认追加，自动跳过重复歌曲

## 🎯 实际应用示例

### 场景一：整理音乐收藏
```
搜索 "Taylor Swift" → 找到所有相关歌曲 → 创建"泰勒专辑"播放列表
```

### 场景二：按音质分类
```
搜索 ".flac" → 选择无损音乐 → 创建"HiFi音乐"播放列表
```

### 场景三：更新播放列表
```
按A键 → 选择已有播放列表 → 添加新歌曲 → 自动去重保存
```

## 🔧 技术特点

### 性能优化
- **ANSI转义码控制**：消除屏幕闪烁，提供流畅体验
- **增量更新**：只刷新变化的部分，响应迅速
- **内存效率**：智能索引管理，支持大量文件

### 用户体验
- **中文界面**：完全中文化的提示和说明
- **智能翻页**：光标自动跟随页面切换
- **状态保持**：搜索时保持选择状态

### 数据安全
- **重复检测**：防止播放列表中出现重复歌曲
- **格式清理**：自动处理HTML实体字符
- **异常处理**：完善的错误处理机制

## 📁 文件结构

```
m3u_weaver/
├── m3u_weaver.py     # 主程序文件
├── music_config.json # 配置文件
├── playlist.m3u      # 生成的播放列表示例
├── README.md         # 项目说明文档
└── LICENSE           # 许可证文件
```

## ⚙️ 高级配置

### 命令行参数详解

| 参数 | 简写 | 说明 | 示例 |
|------|------|------|------|
| `--music-dir` | `-d` | 指定音乐目录 | `-d ~/Music` |
| `--page-size` | - | 每页歌曲数量 | `--page-size 30` |
| `--config` | - | 交互式配置 | `--config` |
| `--reset-config` | - | 重置配置 | `--reset-config` |
| `--help` | `-h` | 显示帮助 | `--help` |

### 支持的路径格式

- **绝对路径**：`/Users/song/Music`
- **相对路径**：`./music`
- **用户目录**：`~/Music`
- **带空格路径**：`"/Users/song/My Music"`

### 配置文件位置

配置文件保存在程序运行目录的 `music_config.json` 中，包含：

```json
{
  "music_dir": "音乐目录路径",
  "page_size": 20
}
```

## 🐛 常见问题

### Q: 程序提示"音乐目录不存在"？
**A**: 有多种解决方案：
- 使用 `python3 m3u_weaver.py --config` 重新配置
- 使用 `python3 m3u_weaver.py -d /path/to/music` 指定正确路径
- 使用 `python3 m3u_weaver.py --reset-config` 重置为默认配置

### Q: 如何更改默认音乐目录？
**A**: 有以下几种方式：
- **临时更改**：`python3 m3u_weaver.py -d ~/Music`
- **永久更改**：`python3 m3u_weaver.py --config` 然后选择新目录
- **直接编辑**：修改 `music_config.json` 文件

### Q: 搜索结果为空？
**A**: 确保搜索关键词包含在歌曲文件名中，搜索不区分大小写。

### Q: 无法选择歌曲？
**A**: 确保文件格式在支持列表中，检查文件是否损坏。

### Q: 播放列表文件在哪里？
**A**: 生成的.m3u文件保存在程序运行的当前目录中。

### Q: 配置文件在哪里？
**A**: `music_config.json` 文件在程序运行目录中，可以手动编辑。

## 🎉 使用技巧

1. **批量选择**：使用搜索功能快速定位特定类型的歌曲
2. **智能命名**：播放列表命名支持中文、英文、数字和常用符号
3. **快速导航**：使用左右方向键比Enter键翻页更快
4. **组合操作**：先搜索缩小范围，再选择具体歌曲
5. **配置技巧**：
   - 初次使用建议运行 `python3 m3u_weaver.py --config` 设置音乐目录
   - 可以为不同音乐库创建不同的配置文件
   - 使用 `--page-size` 调整每页显示数量以适应屏幕大小

## 📝 更新日志

### v1.1.0 (当前版本)
- ✅ **全新配置系统**：支持命令行参数、配置文件、交互式配置
- ✅ **灵活路径配置**：支持绝对路径、相对路径、用户目录
- ✅ **智能配置管理**：自动生成和管理配置文件
- ✅ **命令行参数**：支持 `-d`、`--config`、`--page-size` 等参数
- ✅ **配置优先级**：命令行 > 配置文件 > 交互式 > 默认值

### v1.0.0 
- ✅ 基础播放列表管理功能
- ✅ 交互式用户界面
- ✅ 分页显示支持
- ✅ 屏幕闪烁优化
- ✅ 左右方向键翻页
- ✅ 追加到现有播放列表
- ✅ 智能去重功能
- ✅ 快速搜索功能

## 🤝 贡献说明

这是一个个人项目，专为macOS音乐管理需求设计。如有建议或改进想法，欢迎交流。

## 📄 许可证

本项目仅供个人学习和使用。

---

**享受你的音乐管理体验！** 🎶

> 如果这个工具对你有帮助，不妨给身边的朋友推荐一下！